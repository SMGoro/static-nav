import { useState, useEffect } from 'react';
import { Website } from '../types/website';
import { Button } from './ui/button';
import { Card, CardContent, CardHeader, CardTitle } from './ui/card';
import { Input } from './ui/input';
import { Label } from './ui/label';
import { Textarea } from './ui/textarea';
import { Switch } from './ui/switch';
import { Badge } from './ui/badge';
import { ArrowLeft, Plus, X, Sparkles, Search, Loader2 } from 'lucide-react';




import { LinkPreviewService } from '../services/linkPreviewService';
import { ContentScrapingService, type WebsiteContent, type AIFriendlyContent } from '../services/contentScrapingService';
import { AIService, AIConfig } from '../services/aiService';
import { AIConfigDialog } from './AIConfigDialog';

interface WebsiteFormProps {
  website?: Website;
  onSave: (website: Omit<Website, 'id'>) => void;
  onCancel: () => void;
}

export function WebsiteForm({ website, onSave, onCancel }: WebsiteFormProps) {
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    url: '',
    icon: 'üåê',
    featured: false,
    tags: [] as string[],
    // È´òÁ∫ßËÆæÁΩÆ
    fullDescription: '',
    screenshots: [] as string[],
    language: 'Â§öËØ≠Ë®Ä',
    authoredBy: '',
    isPaid: false,
    features: [] as string[],
    rating: 0,
    reviews: [] as any[]
  });
  const [newTag, setNewTag] = useState('');

  const [isAnalyzing, setIsAnalyzing] = useState(false);
  const [aiConfig, setAiConfig] = useState<AIConfig>(AIService.getDefaultConfig());
  const [showConfigDialog, setShowConfigDialog] = useState(false);
  const [error, setError] = useState('');
  const [showAdvanced, setShowAdvanced] = useState(false);
  const [isAIEnhancing, setIsAIEnhancing] = useState(false);
  const [aiStreamContent, setAiStreamContent] = useState('');
  const [aiProgress, setAiProgress] = useState('');
  const [scrapedContent, setScrapedContent] = useState<WebsiteContent | null>(null);
  const [aiAnalysis, setAiAnalysis] = useState<AIFriendlyContent | null>(null);
  const [showContentPreview, setShowContentPreview] = useState(false);
  const [showSuccessDialog, setShowSuccessDialog] = useState(false);
  const [showAiWarningDialog, setShowAiWarningDialog] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [newFeature, setNewFeature] = useState('');
  const [newScreenshot, setNewScreenshot] = useState('');

  useEffect(() => {
    if (website) {
      console.log('ÂàùÂßãÂåñÁºñËæëË°®ÂçïÔºåÁΩëÁ´ôÊï∞ÊçÆ:', website);

      setFormData({
        title: website.title,
        description: website.description,
        url: website.url,
        icon: website.icon,
        featured: website.featured,
        tags: [...website.tags],
        fullDescription: website.fullDescription || '',
        screenshots: website.screenshots || [],
        language: website.language || 'Â§öËØ≠Ë®Ä',
        authoredBy: website.authoredBy || '',
        isPaid: website.isPaid || false,
        features: website.features || [],
        rating: website.rating || 0,
        reviews: website.reviews || []
      });
    } else {
      // Êñ∞Â¢ûÁΩëÁ´ôÊó∂ÁöÑÈªòËÆ§ÂÄº
      setFormData({
        title: '',
        description: '',
        url: '',
        icon: 'üåê',
        featured: false,
        tags: [],
        fullDescription: '',
        screenshots: [],
        language: 'Â§öËØ≠Ë®Ä',
        authoredBy: '',
        isPaid: false,
        features: [],
        rating: 0,
        reviews: []
      });
    }

    // Âä†ËΩΩAIÈÖçÁΩÆ
    const savedConfig = localStorage.getItem('ai_config');
    if (savedConfig) {
      try {
        const parsed = JSON.parse(savedConfig);
        setAiConfig({ ...AIService.getDefaultConfig(), ...parsed });
      } catch (error) {
        console.error('Âä†ËΩΩAIÈÖçÁΩÆÂ§±Ë¥•:', error);
      }
    }
  }, [website]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    // Ê∑ªÂä†Ë∞ÉËØï‰ø°ÊÅØ
    console.log('Êèê‰∫§Ë°®ÂçïÊï∞ÊçÆ:', formData);
    console.log('È™åËØÅÁªìÊûú:', {
      title: !!formData.title,
      url: !!formData.url,
      description: !!formData.description
    });
    
    if (!formData.title || !formData.url || !formData.description) {
      console.error('Ë°®ÂçïÈ™åËØÅÂ§±Ë¥•ÔºåÁº∫Â∞ëÂøÖÂ°´Â≠óÊÆµ');
      setError('ËØ∑Â°´ÂÜôÊâÄÊúâÂøÖÂ°´Â≠óÊÆµ');
      return;
    }
    
    // ÁîüÊàêSEOÂèãÂ•ΩÁöÑslug
    const generateSlug = (title: string) => {
      return title
        .toLowerCase()
        .replace(/[^a-z0-9\u4e00-\u9fa5]/g, '-')
        .replace(/-+/g, '-')
        .replace(/^-|-$/g, '');
    };
    
    const websiteData = {
      ...formData,
      addedDate: website?.addedDate || new Date().toISOString().split('T')[0],
      clicks: website?.clicks || 0,
      slug: website?.slug || generateSlug(formData.title),
      isBuiltIn: website?.isBuiltIn || false,
      lastUpdated: new Date().toISOString().split('T')[0],
      relatedSites: website?.relatedSites || []
    };
    
    console.log('ÂáÜÂ§á‰øùÂ≠òÁöÑÁΩëÁ´ôÊï∞ÊçÆ:', websiteData);
    
    setIsSubmitting(true);
    setError('');
    
    try {
      await onSave(websiteData);
      console.log(`${website ? 'ÁºñËæë' : 'Ê∑ªÂä†'}ÁΩëÁ´ôÊàêÂäü:`, websiteData);
      
      // Ê†πÊçÆÊìç‰ΩúÁ±ªÂûãÂ§ÑÁêÜÊàêÂäüÂêéÁöÑÈÄªËæë
      if (website) {
        // ÁºñËæëÊ®°ÂºèÔºöÁõ¥Êé•ËøîÂõûÊü•ÁúãÈ°µÈù¢
        onCancel(); // Ëøô‰ºöËß¶ÂèëÁà∂ÁªÑ‰ª∂ÁöÑÂØºËà™ÈÄªËæë
      } else {
        // Ê∑ªÂä†Ê®°ÂºèÔºöÊòæÁ§∫ÊàêÂäüÂØπËØùÊ°Ü
        setShowSuccessDialog(true);
      }
    } catch (error) {
      console.error('‰øùÂ≠òÂ§±Ë¥•:', error);
      setError(error instanceof Error ? error.message : '‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
    } finally {
      setIsSubmitting(false);
    }
  };

  const addTag = () => {
    if (newTag.trim() && !formData.tags.includes(newTag.trim())) {
      setFormData(prev => ({
        ...prev,
        tags: [...prev.tags, newTag.trim()]
      }));
      setNewTag('');
    }
  };

  const removeTag = (tag: string) => {
    setFormData(prev => ({
      ...prev,
      tags: prev.tags.filter(t => t !== tag)
    }));
  };

  // ÈÄöËøáURLËá™Âä®Ëé∑ÂèñÁΩëÁ´ô‰ø°ÊÅØÔºà‰ΩøÁî®jinjaÊ®°ÊùøÔºâ
  const handleAutoFill = async () => {
    if (!formData.url.trim()) {
      setError('ËØ∑ËæìÂÖ•ÁΩëÁ´ôURL');
      return;
    }

    setIsAnalyzing(true);
    setError('');
    setAiProgress('Ê≠£Âú®ÊäìÂèñÁΩëÁ´ôÂÜÖÂÆπ...');

    try {
      // ‰ΩøÁî®ÂÜÖÂÆπÊäìÂèñÊúçÂä°Ëé∑ÂèñËØ¶ÁªÜ‰ø°ÊÅØ
      const contentScrapingService = new ContentScrapingService();
      
      setAiProgress('ÂàÜÊûêÁΩëÁ´ôÁªìÊûÑ...');
      const scrapedData = await contentScrapingService.scrapeWebsiteContent(formData.url);
      setScrapedContent(scrapedData);
      
      setAiProgress('ÁîüÊàêAIÂèãÂ•ΩÁöÑÂàÜÊûêÊï∞ÊçÆ...');
      const aiAnalysisData = contentScrapingService.generateAIFriendlyContent(scrapedData, formData.url);
      setAiAnalysis(aiAnalysisData);
      
      setAiProgress('Êõ¥Êñ∞Ë°®ÂçïÊï∞ÊçÆ...');
      
      // Êõ¥Êñ∞Ë°®ÂçïÊï∞ÊçÆ
      setFormData(prev => ({
        ...prev,
        title: scrapedData.title || prev.title,
        description: scrapedData.description || prev.description,
        icon: scrapedData.favicon || prev.icon,
        tags: [...new Set([...prev.tags, ...aiAnalysisData.contentAnalysis.mainTopics])],
        screenshots: scrapedData.ogImage ? [scrapedData.ogImage] : prev.screenshots,
        language: scrapedData.language || prev.language,
        features: [...new Set([...prev.features, ...aiAnalysisData.contentAnalysis.keyFeatures])]
      }));

      setAiProgress('ÁΩëÁ´ôÂÜÖÂÆπÊäìÂèñÂÆåÊàêÔºÅ');
      
      // ÊòæÁ§∫ÂÜÖÂÆπÈ¢ÑËßàÈÄâÈ°π
      setShowContentPreview(true);
      
      console.log('ÊäìÂèñÂà∞ÁöÑÁΩëÁ´ôÂÜÖÂÆπ:', scrapedData);
      console.log('AIÂàÜÊûêÁªìÊûú:', aiAnalysisData);
      
      // 3ÁßíÂêéÊ∏ÖÈô§ËøõÂ∫¶
      setTimeout(() => {
        setAiProgress('');
      }, 3000);
      
    } catch (error) {
      console.error('ÁΩëÁ´ôÂÜÖÂÆπÊäìÂèñÂ§±Ë¥•:', error);
      setError(error instanceof Error ? error.message : 'ÂÜÖÂÆπÊäìÂèñÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
      
      // Â§áÁî®ÊñπÊ°àÔºö‰ΩøÁî®Âü∫Á°ÄÁöÑ LinkPreviewService
      try {
        setAiProgress('‰ΩøÁî®Â§áÁî®ÊñπÊ°àËé∑ÂèñÂü∫Êú¨‰ø°ÊÅØ...');
        const linkPreviewService = new LinkPreviewService();
        const websiteInfo = await linkPreviewService.getWebsiteInfo(formData.url);
        
        setFormData(prev => ({
          ...prev,
          title: websiteInfo.title,
          description: websiteInfo.description,
          icon: websiteInfo.icon,
          tags: [...websiteInfo.tags],
          screenshots: websiteInfo.image ? [websiteInfo.image] : prev.screenshots
        }));
        
        setAiProgress('Âü∫Êú¨‰ø°ÊÅØËé∑ÂèñÂÆåÊàê');
      } catch (fallbackError) {
        console.error('Â§áÁî®ÊñπÊ°à‰πüÂ§±Ë¥•‰∫Ü:', fallbackError);
        setError('Êó†Ê≥ïËé∑ÂèñÁΩëÁ´ô‰ø°ÊÅØÔºåËØ∑Ê£ÄÊü•URLÊòØÂê¶Ê≠£Á°Æ');
      }
    } finally {
      setIsAnalyzing(false);
    }
  };



  const handleSaveConfig = (config: AIConfig) => {
    setAiConfig(config);
    localStorage.setItem('ai_config', JSON.stringify(config));
  };

  // Ê∏ÖÁ©∫Ë°®Âçï
  const clearForm = () => {
    setFormData({
      title: '',
      description: '',
      url: '',
      icon: 'üåê',
      featured: false,
      tags: [],
      fullDescription: '',
      screenshots: [],
      language: 'Â§öËØ≠Ë®Ä',
      authoredBy: '',
      isPaid: false,
      features: [],
      rating: 0,
      reviews: []
    });
    setScrapedContent(null);
    setAiAnalysis(null);
    setShowContentPreview(false);
    setError('');
    setAiProgress('');
    setAiStreamContent('');
  };

  // Â§ÑÁêÜÊàêÂäüÂØπËØùÊ°ÜÁöÑÈÄâÊã©
  const handleSuccessDialogChoice = (continueAdding: boolean) => {
    setShowSuccessDialog(false);
    
    if (continueAdding) {
      // ÁªßÁª≠Ê∑ªÂä†ÔºöÊ∏ÖÁ©∫Ë°®Âçï
      clearForm();
    } else {
      // ‰∏çÁªßÁª≠Ê∑ªÂä†ÔºöËøîÂõû‰∏ªÈ°µÈù¢
      onCancel();
    }
  };

  // Â§ÑÁêÜAIË≠¶ÂëäÂØπËØùÊ°ÜÁöÑÈÄâÊã©
  const handleAiWarningChoice = async (continueWithoutContent: boolean) => {
    setShowAiWarningDialog(false);
    
    if (continueWithoutContent) {
      // Áî®Êà∑ÈÄâÊã©ÁªßÁª≠ÔºöÁõ¥Êé•ÊâßË°åAIÂ¢ûÂº∫Ôºà‰∏çÂü∫‰∫éÁΩëÁ´ôÂÜÖÂÆπÔºâ
      await performAIEnhancement();
    } else {
      // Áî®Êà∑ÈÄâÊã©‰∏çÁªßÁª≠ÔºöÊ∏ÖÈô§ËøõÂ∫¶Áä∂ÊÄÅ
      setAiProgress('');
    }
  };

  // AIÂ¢ûÂº∫ÂäüËÉΩÔºàÊµÅÂºèËæìÂá∫Ôºâ
  const handleAIEnhancement = async () => {
    if (!formData.title || !formData.url) {
      setError('ËØ∑ÂÖàÂ°´ÂÜôÁΩëÁ´ôÊ†áÈ¢òÂíåÈìæÊé•');
      return;
    }

    // Ê£ÄÊü•ÊòØÂê¶Â∑≤Ëé∑ÂèñÁΩëÁ´ôÂÜÖÂÆπ
    if (!scrapedContent || !aiAnalysis) {
      // Â∞ùËØïËá™Âä®Ëé∑ÂèñÁΩëÁ´ôÂÜÖÂÆπ
      setAiProgress('Ê≠£Âú®Ëé∑ÂèñÁΩëÁ´ôÂÜÖÂÆπ...');
      try {
        await handleAutoFillForAI();
        
        // Â¶ÇÊûúËøòÊòØÊ≤°ÊúâËé∑ÂèñÂà∞ÂÜÖÂÆπÔºåÊòæÁ§∫Ë≠¶ÂëäÂØπËØùÊ°Ü
        if (!scrapedContent || !aiAnalysis) {
          setShowAiWarningDialog(true);
          return;
        }
      } catch (error) {
        console.error('Ëá™Âä®Ëé∑ÂèñÁΩëÁ´ôÂÜÖÂÆπÂ§±Ë¥•:', error);
        setShowAiWarningDialog(true);
        return;
      }
    }

    await performAIEnhancement();
  };

  // ‰∏∫AIÂ¢ûÂº∫‰∏ìÈó®Ëé∑ÂèñÁΩëÁ´ôÂÜÖÂÆπÔºà‰∏çÊõ¥Êñ∞Ë°®ÂçïÔºâ
  const handleAutoFillForAI = async () => {
    if (!formData.url.trim()) {
      throw new Error('ËØ∑ÂÖàËæìÂÖ•ÁΩëÁ´ôURL');
    }

    try {
      const contentScrapingService = new ContentScrapingService();
      
      setAiProgress('ÂàÜÊûêÁΩëÁ´ôÁªìÊûÑ...');
      const scrapedData = await contentScrapingService.scrapeWebsiteContent(formData.url);
      
      setAiProgress('ÁîüÊàêAIÂèãÂ•ΩÁöÑÂàÜÊûêÊï∞ÊçÆ...');
      const aiAnalysisData = contentScrapingService.generateAIFriendlyContent(scrapedData, formData.url);
      
      // Âè™ËÆæÁΩÆÂÜÖÂÆπÔºå‰∏çÊõ¥Êñ∞Ë°®ÂçïÊï∞ÊçÆ
      setScrapedContent(scrapedData);
      setAiAnalysis(aiAnalysisData);
      
      console.log('‰∏∫AIÂ¢ûÂº∫Ëé∑ÂèñÁöÑÁΩëÁ´ôÂÜÖÂÆπ:', scrapedData);
      console.log('AIÂàÜÊûêÁªìÊûú:', aiAnalysisData);
      
    } catch (error) {
      console.error('Ëé∑ÂèñÁΩëÁ´ôÂÜÖÂÆπÂ§±Ë¥•:', error);
      throw error;
    }
  };

  // ÊâßË°åAIÂ¢ûÂº∫ÁöÑÊ†∏ÂøÉÈÄªËæë
  const performAIEnhancement = async () => {
    setIsAIEnhancing(true);
    setError('');
    setAiStreamContent('');
    setAiProgress('Ê≠£Âú®ËøûÊé•AIÊúçÂä°...');

    try {
      const aiService = new AIService(aiConfig);
      // ÊûÑÂª∫Â¢ûÂº∫ÁöÑAIÊèêÁ§∫ËØçÔºåÂåÖÂê´ÊäìÂèñÂà∞ÁöÑËØ¶ÁªÜÂÜÖÂÆπ
      let prompt = `ËØ∑Âü∫‰∫é‰ª•‰∏ãËØ¶ÁªÜÁöÑÁΩëÁ´ôÂàÜÊûê‰ø°ÊÅØÁîüÊàêÂáÜÁ°ÆÁöÑÁΩëÁ´ôÊèèËø∞ÂíåÊ†áÁ≠æÔºö

## Âü∫Êú¨‰ø°ÊÅØ
- ÁΩëÁ´ôÊ†áÈ¢òÔºö${formData.title}
- ÁΩëÁ´ôÊèèËø∞Ôºö${formData.description}
- ÁΩëÁ´ôURLÔºö${formData.url}
- ÂΩìÂâçÊ†áÁ≠æÔºö${formData.tags.join(', ')}`;

      // Â¶ÇÊûúÊúâÊäìÂèñÂà∞ÁöÑÂÜÖÂÆπÔºåÊ∑ªÂä†ËØ¶ÁªÜÂàÜÊûê
      if (aiAnalysis && scrapedContent) {
        prompt += `

## ËØ¶ÁªÜÂÜÖÂÆπÂàÜÊûê
- ‰∏ªË¶ÅËØùÈ¢òÔºö${aiAnalysis.contentAnalysis.mainTopics.join(', ')}
- ÂÖ≥ÈîÆÂäüËÉΩÔºö${aiAnalysis.contentAnalysis.keyFeatures.join(', ')}
- ÁõÆÊ†áÂèó‰ºóÔºö${aiAnalysis.contentAnalysis.targetAudience}
- ÂÜÖÂÆπÁ±ªÂûãÔºö${aiAnalysis.contentAnalysis.contentType}
- Ê£ÄÊµãÂà∞ÁöÑÊäÄÊúØÔºö${aiAnalysis.technicalInfo.technologies.join(', ')}
- ÁΩëÁ´ôÂπ≥Âè∞Ôºö${aiAnalysis.technicalInfo.platform}
- ÊòØÂê¶ÁîµÂïÜÔºö${aiAnalysis.technicalInfo.isEcommerce ? 'ÊòØ' : 'Âê¶'}
- ÊòØÂê¶ÂçöÂÆ¢Ôºö${aiAnalysis.technicalInfo.isBlog ? 'ÊòØ' : 'Âê¶'}
- Á§æ‰∫§Âπ≥Âè∞Ôºö${aiAnalysis.socialPresence.socialPlatforms.join(', ')}
- ÊúâËÅîÁ≥ªÊñπÂºèÔºö${aiAnalysis.socialPresence.hasContactInfo ? 'ÊòØ' : 'Âê¶'}

## Ë¥®ÈáèËØÑ‰º∞
- ÂÜÖÂÆπ‰∏∞ÂØåÂ∫¶Ôºö${aiAnalysis.qualityIndicators.contentRichness}/10
- ‰∏ì‰∏öÁ®ãÂ∫¶Ôºö${aiAnalysis.qualityIndicators.professionalLevel}/10
- Áî®Êà∑ÂèÇ‰∏éÂ∫¶Ôºö${aiAnalysis.qualityIndicators.userEngagement}/10

## ÁΩëÁ´ôÂÜÖÂÆπÊëòË¶Å
${scrapedContent.textContent.slice(0, 500)}...

## È°µÈù¢ÁªìÊûÑ
- H1Ê†áÈ¢òÔºö${scrapedContent.headings.h1.slice(0, 3).join(', ')}
- H2Ê†áÈ¢òÔºö${scrapedContent.headings.h2.slice(0, 5).join(', ')}
- ÂõæÁâáÊï∞ÈáèÔºö${scrapedContent.images.length}
- Â§ñÈÉ®ÈìæÊé•Ôºö${scrapedContent.links.external.length}`;
      }

      prompt += `

ËØ∑Âü∫‰∫é‰ª•‰∏ä‰ø°ÊÅØÁîüÊàêÔºö
1. Êõ¥ÂáÜÁ°ÆËØ¶ÁªÜÁöÑÁΩëÁ´ô‰ªãÁªçÔºà200-300Â≠óÔºåË¶Å‰ΩìÁé∞ÁΩëÁ´ôÁöÑÊ†∏ÂøÉ‰ª∑ÂÄºÂíåÁâπËâ≤Ôºâ
2. Á≤æÁ°ÆÁöÑÊ†áÁ≠æÔºà5-8‰∏™ÔºåÂü∫‰∫éÂÆûÈôÖÂÜÖÂÆπÂàÜÊûêÔºâ
3. ‰∏ªË¶ÅÂäüËÉΩÁâπÊÄßÔºà3-6‰∏™ÔºåÂü∫‰∫éÁΩëÁ´ôÂÆûÈôÖÂäüËÉΩÔºâ
4. ÁΩëÁ´ô‰ΩúËÄÖÊàñÂÖ¨Âè∏‰ø°ÊÅØÔºàÂü∫‰∫éÊäìÂèñÂà∞ÁöÑ‰ø°ÊÅØÊé®Êñ≠Ôºâ
5. ‰∏ªË¶Å‰ΩøÁî®ËØ≠Ë®Ä
6. ÊòØÂê¶‰∏∫‰ªòË¥πÊúçÂä°ÔºàÂü∫‰∫éÂÜÖÂÆπÂàÜÊûêÂà§Êñ≠Ôºâ

ËØ∑‰ª•JSONÊ†ºÂºèËøîÂõûÔºö
{
  "fullDescription": "Âü∫‰∫éÂÆûÈôÖÂÜÖÂÆπÁöÑËØ¶ÁªÜÁΩëÁ´ô‰ªãÁªç",
  "tags": ["Á≤æÁ°ÆÊ†áÁ≠æ1", "Á≤æÁ°ÆÊ†áÁ≠æ2", "Á≤æÁ°ÆÊ†áÁ≠æ3"],
  "features": ["ÂÆûÈôÖÂäüËÉΩ1", "ÂÆûÈôÖÂäüËÉΩ2", "ÂÆûÈôÖÂäüËÉΩ3"],
  "authoredBy": "‰ΩúËÄÖÊàñÂÖ¨Âè∏ÔºàÂü∫‰∫éÂàÜÊûêÔºâ",
  "language": "‰∏ªË¶ÅËØ≠Ë®Ä",
  "isPaid": false
}`;

      // Â∞ùËØï‰ΩøÁî®ÊµÅÂºèËæìÂá∫ÔºåÂ¶ÇÊûúÂ§±Ë¥•Âàô‰ΩøÁî®ÊôÆÈÄöÊñπÊ≥ï
      let response;
      try {
        response = await aiService.getRecommendationsStream(
          {
            query: prompt,
            maxResults: 1
          },
          (chunk) => {
            switch (chunk.type) {
              case 'start':
                setAiProgress('AIÂºÄÂßãÂàÜÊûê...');
                break;
              case 'content':
                setAiProgress('Ê≠£Âú®ÁîüÊàêÂÜÖÂÆπ...');
                setAiStreamContent(prev => prev + ((chunk.data as any).content || ''));
                break;
              case 'website':
                setAiProgress('Ëß£ÊûêÁΩëÁ´ô‰ø°ÊÅØ...');
                break;
              case 'reasoning':
                setAiProgress('ÂÆåÂñÑÊé®ÁêÜÈÄªËæë...');
                break;
              case 'confidence':
                setAiProgress('ËØÑ‰º∞ÁΩÆ‰ø°Â∫¶...');
                break;
              case 'end':
                setAiProgress('AIÂàÜÊûêÂÆåÊàê');
                break;
              case 'error':
                setAiProgress('AIÂàÜÊûêÂá∫Èîô');
                setError((chunk.data as any).message as string || 'AIÂ§ÑÁêÜÂá∫Èîô');
                break;
            }
          }
        );
      } catch (streamError) {
        console.warn('ÊµÅÂºèËæìÂá∫Â§±Ë¥•Ôºå‰ΩøÁî®ÊôÆÈÄöÊ®°Âºè:', streamError);
        setAiProgress('‰ΩøÁî®Ê†áÂáÜAIÊ®°Âºè...');
        
        // Â§áÁî®ÊñπÊ°àÔºö‰ΩøÁî®ÊôÆÈÄöÁöÑ getRecommendations
        response = await aiService.getRecommendations({
          query: prompt,
          maxResults: 1
        });
      }

      // Ëß£ÊûêAIÂìçÂ∫î
      let aiData = {
        fullDescription: formData.description,
        tags: formData.tags,
        features: formData.features,
        authoredBy: formData.authoredBy,
        language: formData.language,
        isPaid: formData.isPaid
      };

      // Ë∞ÉËØï‰ø°ÊÅØ
      console.log('AIÂìçÂ∫îËØ¶ÊÉÖ:', {
        reasoning: response.reasoning,
        websites: response.websites,
        streamContent: aiStreamContent,
        confidence: response.confidence
      });

      // Â∞ùËØïÂ§öÁßçËß£ÊûêÊñπÂºè
      let parseSuccess = false;
      try {
        // ÊñπÂºè1: ‰ªé reasoning ‰∏≠Ëß£Êûê
        if (response.reasoning) {
          console.log('Â∞ùËØï‰ªé reasoning Ëß£Êûê...');
          const jsonMatch = response.reasoning.match(/\{[\s\S]*\}/);
          if (jsonMatch) {
            const parsed = JSON.parse(jsonMatch[0]);
            aiData = { ...aiData, ...parsed };
            parseSuccess = true;
            console.log('‰ªé reasoning Ëß£ÊûêÊàêÂäü:', parsed);
          }
        }
        
        // ÊñπÂºè2: ‰ªé websites[0] ‰∏≠Ëé∑Âèñ
        if (!parseSuccess && response.websites && response.websites.length > 0) {
          console.log('Â∞ùËØï‰ªé websites[0] Ëß£Êûê...');
          const website = response.websites[0];
          const websiteData = {
            fullDescription: website.fullDescription || aiData.fullDescription,
            tags: website.tags || aiData.tags,
            features: website.features || aiData.features,
            authoredBy: website.authoredBy || aiData.authoredBy,
            language: website.language || aiData.language,
            isPaid: website.isPaid !== undefined ? website.isPaid : aiData.isPaid
          };
          
          // Ê£ÄÊü•ÊòØÂê¶ÊúâÊúâÊïàÊï∞ÊçÆ
          if (websiteData.fullDescription !== aiData.fullDescription || 
              (websiteData.tags && websiteData.tags.length > aiData.tags.length)) {
            aiData = websiteData;
            parseSuccess = true;
            console.log('‰ªé websites[0] Ëß£ÊûêÊàêÂäü:', websiteData);
          }
        }

        // ÊñπÂºè3: ‰ªéÊµÅÂºèÂÜÖÂÆπ‰∏≠Ëß£Êûê
        if (!parseSuccess && aiStreamContent) {
          console.log('Â∞ùËØï‰ªéÊµÅÂºèÂÜÖÂÆπËß£Êûê...');
          const streamJsonMatch = aiStreamContent.match(/\{[\s\S]*\}/);
          if (streamJsonMatch) {
            try {
              const streamParsed = JSON.parse(streamJsonMatch[0]);
              aiData = { ...aiData, ...streamParsed };
              parseSuccess = true;
              console.log('‰ªéÊµÅÂºèÂÜÖÂÆπËß£ÊûêÊàêÂäü:', streamParsed);
            } catch (streamParseError) {
              console.warn('ÊµÅÂºèÂÜÖÂÆπJSONËß£ÊûêÂ§±Ë¥•:', streamParseError);
            }
          }
        }

        if (!parseSuccess) {
          console.warn('ÊâÄÊúâËß£ÊûêÊñπÂºèÈÉΩÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂÄº');
          setAiProgress('AIÂìçÂ∫îËß£ÊûêÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
      } catch (parseError) {
        console.warn('AIÂìçÂ∫îËß£ÊûêÂ§±Ë¥•:', parseError);
        setAiProgress('AIÂìçÂ∫îËß£ÊûêÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
      }

      // Êõ¥Êñ∞Ë°®ÂçïÊï∞ÊçÆ
      setFormData(prev => ({
        ...prev,
        fullDescription: aiData.fullDescription || prev.fullDescription,
        tags: aiData.tags && aiData.tags.length > 0 
          ? [...new Set([...aiData.tags, ...prev.tags])] 
          : prev.tags,
        features: aiData.features && aiData.features.length > 0
          ? [...new Set([...aiData.features, ...prev.features])]
          : prev.features,
        authoredBy: aiData.authoredBy || prev.authoredBy,
        language: aiData.language || prev.language,
        isPaid: aiData.isPaid !== undefined ? aiData.isPaid : prev.isPaid
      }));

      setAiProgress('AIÂ¢ûÂº∫ÂÆåÊàêÔºÅ');
      
      // 3ÁßíÂêéÊ∏ÖÈô§ËøõÂ∫¶‰ø°ÊÅØ
      setTimeout(() => {
        setAiProgress('');
        setAiStreamContent('');
      }, 3000);

    } catch (error) {
      console.error('AIÂ¢ûÂº∫Â§±Ë¥•:', error);
      setError(error instanceof Error ? error.message : 'AIÂ¢ûÂº∫Â§±Ë¥•');
      setAiProgress('AIÂ¢ûÂº∫Â§±Ë¥•');
    } finally {
      setIsAIEnhancing(false);
    }
  };

  // Ê∑ªÂä†ÂäüËÉΩÁâπÊÄß
  const addFeature = () => {
    if (newFeature.trim() && !formData.features.includes(newFeature.trim())) {
      setFormData(prev => ({
        ...prev,
        features: [...prev.features, newFeature.trim()]
      }));
      setNewFeature('');
    }
  };

  // Âà†Èô§ÂäüËÉΩÁâπÊÄß
  const removeFeature = (feature: string) => {
    setFormData(prev => ({
      ...prev,
      features: prev.features.filter(f => f !== feature)
    }));
  };

  // Ê∑ªÂä†Êà™Âõæ
  const addScreenshot = () => {
    if (newScreenshot.trim() && !formData.screenshots.includes(newScreenshot.trim())) {
      setFormData(prev => ({
        ...prev,
        screenshots: [...prev.screenshots, newScreenshot.trim()]
      }));
      setNewScreenshot('');
    }
  };

  // Âà†Èô§Êà™Âõæ
  const removeScreenshot = (screenshot: string) => {
    setFormData(prev => ({
      ...prev,
      screenshots: prev.screenshots.filter(s => s !== screenshot)
    }));
  };

  return (
    <div className="max-w-4xl mx-auto p-6">
      <div className="flex items-center gap-2 mb-6">
        <Button variant="ghost" onClick={onCancel}>
          <ArrowLeft className="w-4 h-4" />
        </Button>
        <h1>{website ? 'ÁºñËæëÁΩëÁ´ô' : 'Ê∑ªÂä†ÁΩëÁ´ô'}</h1>
      </div>

      <Card>
        <CardHeader>
          <CardTitle>{website ? 'ÁºñËæëÁΩëÁ´ô‰ø°ÊÅØ' : 'Ê∑ªÂä†Êñ∞ÁΩëÁ´ô'}</CardTitle>
        </CardHeader>
        <CardContent>
          <form onSubmit={handleSubmit} className="space-y-6">
            {error && (
              <div className="p-3 rounded-lg bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400">
                {error}
              </div>
            )}

            {/* URLËæìÂÖ•ÂíåËá™Âä®Ëé∑Âèñ */}
            <div className="space-y-2">
              <Label htmlFor="url">ÁΩëÁ´ôÈìæÊé• *</Label>
              <div className="flex gap-2">
                <Input
                  id="url"
                  type="url"
                  value={formData.url}
                  onChange={(e) => setFormData(prev => ({ ...prev, url: e.target.value }))}
                  placeholder="https://example.com"
                  required
                  className="flex-1"
                />
                <Button 
                  type="button"
                  onClick={handleAutoFill}
                  disabled={!formData.url.trim() || isAnalyzing}
                  variant="outline"
                  className="gap-2"
                >
                  {isAnalyzing ? (
                    <>
                      <Loader2 className="w-4 h-4 animate-spin" />
                      Ëé∑Âèñ‰∏≠...
                    </>
                  ) : (
                    <>
                      <Search className="w-4 h-4" />
                      Ëá™Âä®Ëé∑Âèñ
                    </>
                  )}
                </Button>
              </div>
              <p className="text-sm text-muted-foreground">
                ËæìÂÖ•ÁΩëÁ´ôURLÂêéÁÇπÂáª"Ëá™Âä®Ëé∑Âèñ"ÊåâÈíÆÔºåÂ∞ÜÊ∑±Â∫¶ÊäìÂèñÁΩëÁ´ôÂÜÖÂÆπÂπ∂ËøõË°åÊô∫ËÉΩÂàÜÊûê
              </p>

              {/* ÂÜÖÂÆπÊäìÂèñËøõÂ∫¶ÂíåÈ¢ÑËßà */}
              {(isAnalyzing || aiProgress || showContentPreview) && (
                <div className="mt-4 space-y-3">
                  {/* ËøõÂ∫¶ÊåáÁ§∫ */}
                  {aiProgress && (
                    <div className="flex items-center gap-2 text-sm">
                      <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                      <span className="text-muted-foreground">{aiProgress}</span>
                    </div>
                  )}

                  {/* ÂÜÖÂÆπÈ¢ÑËßà */}
                  {showContentPreview && scrapedContent && aiAnalysis && (
                    <div className="bg-background/50 rounded-md p-3 border">
                      <div className="flex items-center justify-between mb-2">
                        <div className="text-xs font-medium text-muted-foreground">ÊäìÂèñÂÜÖÂÆπÈ¢ÑËßà</div>
                        <Button
                          type="button"
                          variant="ghost"
                          size="sm"
                          onClick={() => setShowContentPreview(false)}
                        >
                          <X className="w-3 h-3" />
                        </Button>
                      </div>
                      
                      <div className="space-y-2 text-xs">
                        <div>
                          <span className="font-medium">Ê£ÄÊµãÊäÄÊúØÔºö</span>
                          <span className="text-muted-foreground">
                            {aiAnalysis.technicalInfo.technologies.join(', ') || 'Êú™Ê£ÄÊµãÂà∞'}
                          </span>
                        </div>
                        <div>
                          <span className="font-medium">‰∏ªË¶ÅËØùÈ¢òÔºö</span>
                          <span className="text-muted-foreground">
                            {aiAnalysis.contentAnalysis.mainTopics.join(', ')}
                          </span>
                        </div>
                        <div>
                          <span className="font-medium">ÁõÆÊ†áÂèó‰ºóÔºö</span>
                          <span className="text-muted-foreground">
                            {aiAnalysis.contentAnalysis.targetAudience}
                          </span>
                        </div>
                        <div>
                          <span className="font-medium">Ë¥®ÈáèËØÑÂàÜÔºö</span>
                          <span className="text-muted-foreground">
                            ÂÜÖÂÆπ {aiAnalysis.qualityIndicators.contentRichness}/10, 
                            ‰∏ì‰∏ö {aiAnalysis.qualityIndicators.professionalLevel}/10, 
                            ÂèÇ‰∏é {aiAnalysis.qualityIndicators.userEngagement}/10
                          </span>
                        </div>
                        {scrapedContent.textContent && (
                          <div>
                            <span className="font-medium">ÂÜÖÂÆπÊëòË¶ÅÔºö</span>
                            <div className="text-muted-foreground mt-1 max-h-20 overflow-y-auto">
                              {scrapedContent.textContent.slice(0, 200)}...
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                </div>
              )}
            </div>

            {/* Âü∫Êú¨‰ø°ÊÅØ */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label htmlFor="title">ÁΩëÁ´ôÂêçÁß∞ *</Label>
                <Input
                  id="title"
                  value={formData.title}
                  onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}
                  placeholder="ËæìÂÖ•ÁΩëÁ´ôÂêçÁß∞"
                  required
                />
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="icon">ÂõæÊ†á</Label>
                <Input
                  id="icon"
                  value={formData.icon}
                  onChange={(e) => setFormData(prev => ({ ...prev, icon: e.target.value }))}
                  placeholder="üåê"
                  className="text-center"
                />
              </div>
            </div>

            <div className="space-y-2">
              <Label htmlFor="description">ÁΩëÁ´ôÊèèËø∞ *</Label>
              <Textarea
                id="description"
                value={formData.description}
                onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}
                placeholder="ËæìÂÖ•ÁΩëÁ´ôÊèèËø∞..."
                rows={3}
                required
              />
            </div>

            {/* Ê†áÁ≠æÁÆ°ÁêÜ */}
            <div className="space-y-2">
              <Label>Ê†áÁ≠æ</Label>
              <div className="flex gap-2 mb-2">
                <Input
                  value={newTag}
                  onChange={(e) => setNewTag(e.target.value)}
                  placeholder="Ê∑ªÂä†Ê†áÁ≠æ"
                  onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), addTag())}
                />
                <Button 
                  type="button" 
                  onClick={(e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    addTag();
                  }} 
                  size="sm" 
                  variant="outline"
                >
                  <Plus className="w-4 h-4" />
                </Button>
              </div>
              <div className="flex flex-wrap gap-2">
                {formData.tags.map((tag, index) => (
                  <Badge 
                    key={`${tag}-${index}`} 
                    variant="secondary"
                    className="gap-1 pr-1"
                  >
                    <span>{tag}</span>
                    <button
                      type="button"
                      className="ml-1 hover:bg-destructive/20 rounded-sm p-0.5"
                      onClick={(e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        removeTag(tag);
                      }}
                    >
                      <X className="w-3 h-3 text-muted-foreground hover:text-destructive" />
                    </button>
                  </Badge>
                ))}
              </div>
            </div>

            {/* AIÂ¢ûÂº∫Âå∫Âüü */}
            <div className="p-4 bg-muted/30 rounded-lg space-y-4">
              <div className="flex items-center justify-between">
                <div>
                  <h3 className="font-medium">AIÊô∫ËÉΩÂ¢ûÂº∫</h3>
                  <p className="text-sm text-muted-foreground">
                    {scrapedContent && aiAnalysis 
                      ? 'Âü∫‰∫éÊäìÂèñÁöÑÁΩëÁ´ôÂÜÖÂÆπËøõË°åAIÊô∫ËÉΩÂàÜÊûêÂíåÂ¢ûÂº∫'
                      : '‰ΩøÁî®AIËá™Âä®ÁîüÊàêËØ¶ÁªÜ‰ªãÁªç„ÄÅÂäüËÉΩÁâπÊÄß„ÄÅÊ†áÁ≠æÁ≠âÂÜÖÂÆπ'
                    }
                  </p>
                  {scrapedContent && aiAnalysis && (
                    <div className="flex items-center gap-1 mt-1">
                      <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                      <span className="text-xs text-green-600">Â∑≤Ëé∑ÂèñÁΩëÁ´ôËØ¶ÁªÜÂÜÖÂÆπ</span>
                    </div>
                  )}
                </div>
                <Button
                  type="button"
                  onClick={handleAIEnhancement}
                  disabled={!formData.title || !formData.url || isAIEnhancing}
                  className="gap-2"
                  variant={scrapedContent && aiAnalysis ? "default" : "outline"}
                >
                  {isAIEnhancing ? (
                    <>
                      <Loader2 className="w-4 h-4 animate-spin" />
                      AIÂ¢ûÂº∫‰∏≠...
                    </>
                  ) : (
                    <>
                      <Sparkles className="w-4 h-4" />
                      {scrapedContent && aiAnalysis ? 'AIÂ¢ûÂº∫' : 'AIÂ¢ûÂº∫ (ÈúÄÂÖàËé∑ÂèñÂÜÖÂÆπ)'}
                    </>
                  )}
                </Button>
              </div>

              {/* AIÊµÅÂºèËæìÂá∫Â±ïÁ§∫ */}
              {(isAIEnhancing || aiProgress || aiStreamContent) && (
                <div className="space-y-3">
                  {/* ËøõÂ∫¶ÊåáÁ§∫ */}
                  {aiProgress && (
                    <div className="flex items-center gap-2 text-sm">
                      <div className="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                      <span className="text-muted-foreground">{aiProgress}</span>
                    </div>
                  )}

                  {/* ÊµÅÂºèÂÜÖÂÆπÂ±ïÁ§∫ */}
                  {aiStreamContent && (
                    <div className="bg-background/50 rounded-md p-3 border">
                      <div className="text-xs text-muted-foreground mb-2">AIÁîüÊàêÂÜÖÂÆπÈ¢ÑËßàÔºö</div>
                      <div className="text-sm font-mono whitespace-pre-wrap max-h-32 overflow-y-auto">
                        {aiStreamContent}
                        {isAIEnhancing && <span className="animate-pulse">|</span>}
                      </div>
                    </div>
                  )}

                  {/* ËøõÂ∫¶Êù° */}
                  {isAIEnhancing && (
                    <div className="w-full bg-muted rounded-full h-1">
                      <div className="bg-blue-500 h-1 rounded-full animate-pulse" style={{ width: '60%' }}></div>
                    </div>
                  )}
                </div>
              )}
            </div>

            {/* Á≤æÈÄâËÆæÁΩÆÂíåÈ´òÁ∫ßËÆæÁΩÆÂàáÊç¢ */}
            <div className="flex items-center justify-between">
              <div className="flex items-center space-x-2">
                <Switch
                  id="featured"
                  checked={formData.featured}
                  onCheckedChange={(checked) => setFormData(prev => ({ ...prev, featured: checked }))}
                />
                <Label htmlFor="featured">ËÆæ‰∏∫Á≤æÈÄâ</Label>
              </div>
              <Button
                type="button"
                variant="outline"
                size="sm"
                onClick={() => setShowAdvanced(!showAdvanced)}
                className="gap-2"
              >
                {showAdvanced ? 'ÈöêËóè' : 'ÊòæÁ§∫'}È´òÁ∫ßËÆæÁΩÆ
              </Button>
            </div>

            {/* È´òÁ∫ßËÆæÁΩÆ */}
            {showAdvanced && (
              <div className="space-y-4 p-4 border rounded-lg bg-muted/50">
                <h3 className="text-lg font-semibold">È´òÁ∫ßËÆæÁΩÆ</h3>
                
                {/* ËØ¶ÁªÜ‰ªãÁªç */}
                <div className="space-y-2">
                  <Label htmlFor="fullDescription">ËØ¶ÁªÜ‰ªãÁªç</Label>
                  <Textarea
                    id="fullDescription"
                    value={formData.fullDescription}
                    onChange={(e) => setFormData(prev => ({ ...prev, fullDescription: e.target.value }))}
                    placeholder="ËæìÂÖ•ÁΩëÁ´ôÁöÑËØ¶ÁªÜ‰ªãÁªç..."
                    rows={4}
                  />
                </div>

                {/* ÂäüËÉΩÁâπÊÄß */}
                <div className="space-y-2">
                  <Label>ÂäüËÉΩÁâπÊÄß</Label>
                  <div className="flex gap-2 mb-2">
                    <Input
                      value={newFeature}
                      onChange={(e) => setNewFeature(e.target.value)}
                      placeholder="Ê∑ªÂä†ÂäüËÉΩÁâπÊÄß"
                      onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), addFeature())}
                    />
                    <Button type="button" onClick={addFeature} size="sm" variant="outline">
                      <Plus className="w-4 h-4" />
                    </Button>
                  </div>
                  <div className="space-y-1">
                    {formData.features.map((feature, index) => (
                      <div key={index} className="flex items-center justify-between p-2 bg-background rounded border">
                        <span className="text-sm">{feature}</span>
                        <Button
                          type="button"
                          variant="ghost"
                          size="sm"
                          onClick={() => removeFeature(feature)}
                        >
                          <X className="w-3 h-3" />
                        </Button>
                      </div>
                    ))}
                  </div>
                </div>

                {/* ÁΩëÁ´ôÊà™Âõæ */}
                <div className="space-y-2">
                  <Label>ÁΩëÁ´ôÊà™Âõæ</Label>
                  <div className="flex gap-2 mb-2">
                    <Input
                      value={newScreenshot}
                      onChange={(e) => setNewScreenshot(e.target.value)}
                      placeholder="Ê∑ªÂä†Êà™ÂõæURL"
                      onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), addScreenshot())}
                    />
                    <Button type="button" onClick={addScreenshot} size="sm" variant="outline">
                      <Plus className="w-4 h-4" />
                    </Button>
                  </div>
                  <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                    {formData.screenshots.map((screenshot, index) => (
                      <div key={index} className="relative group">
                        <img 
                          src={screenshot} 
                          alt={`Êà™Âõæ ${index + 1}`} 
                          className="w-full h-24 object-cover rounded border"
                          onError={(e) => {
                            e.currentTarget.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiBmaWxsPSIjZjNmNGY2Ii8+CjxwYXRoIGQ9Im0xNSA5LTYgNi02LTYiIHN0cm9rZT0iIzk0YTNiOCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+';
                          }}
                        />
                        <Button
                          type="button"
                          variant="destructive"
                          size="sm"
                          className="absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity"
                          onClick={() => removeScreenshot(screenshot)}
                        >
                          <X className="w-3 h-3" />
                        </Button>
                      </div>
                    ))}
                  </div>
                </div>

                {/* ÂÖ∂‰ªñËÆæÁΩÆ */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div className="space-y-2">
                    <Label htmlFor="language">‰∏ªË¶ÅËØ≠Ë®Ä</Label>
                    <select
                      id="language"
                      value={formData.language}
                      onChange={(e) => setFormData(prev => ({ ...prev, language: e.target.value }))}
                      className="w-full px-3 py-2 border rounded-md bg-background"
                    >
                      <option value="‰∏≠Êñá">‰∏≠Êñá</option>
                      <option value="English">English</option>
                      <option value="Â§öËØ≠Ë®Ä">Â§öËØ≠Ë®Ä</option>
                      <option value="ÂÖ∂‰ªñ">ÂÖ∂‰ªñ</option>
                    </select>
                  </div>
                  
                  <div className="space-y-2">
                    <Label htmlFor="authoredBy">‰ΩúËÄÖ/ÂÖ¨Âè∏</Label>
                    <Input
                      id="authoredBy"
                      value={formData.authoredBy}
                      onChange={(e) => setFormData(prev => ({ ...prev, authoredBy: e.target.value }))}
                      placeholder="ÁΩëÁ´ô‰ΩúËÄÖÊàñÂÖ¨Âè∏ÂêçÁß∞"
                    />
                  </div>

                  <div className="flex items-center space-x-2 pt-6">
                    <Switch
                      id="isPaid"
                      checked={formData.isPaid}
                      onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isPaid: checked }))}
                    />
                    <Label htmlFor="isPaid">‰ªòË¥πÊúçÂä°</Label>
                  </div>
                </div>
              </div>
            )}

            {/* ‰øùÂ≠òÊåâÈíÆ */}
            <div className="flex justify-end gap-2">
              <Button type="button" variant="outline" onClick={onCancel}>
                ÂèñÊ∂à
              </Button>
              <Button type="submit" disabled={isSubmitting}>
                {isSubmitting ? (
                  <>
                    <Loader2 className="w-4 h-4 animate-spin mr-2" />
                    {website ? '‰øùÂ≠ò‰∏≠...' : 'Ê∑ªÂä†‰∏≠...'}
                  </>
                ) : (
                  website ? '‰øùÂ≠ò‰øÆÊîπ' : 'Ê∑ªÂä†ÁΩëÁ´ô'
                )}
              </Button>
            </div>
          </form>
        </CardContent>
      </Card>

      {/* AIÈÖçÁΩÆÂØπËØùÊ°Ü */}
      <AIConfigDialog
        isOpen={showConfigDialog}
        onClose={() => setShowConfigDialog(false)}
        onSave={handleSaveConfig}
        currentConfig={aiConfig}
      />

      {/* Ê∑ªÂä†ÊàêÂäüÂØπËØùÊ°Ü */}
      {showSuccessDialog && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
          <Card className="w-full max-w-md mx-4">
            <CardHeader className="text-center">
              <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                  <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                  </svg>
                </div>
              </div>
              <CardTitle className="text-green-700">ÁΩëÁ´ôÊ∑ªÂä†ÊàêÂäüÔºÅ</CardTitle>
            </CardHeader>
            <CardContent className="text-center space-y-4">
              <p className="text-muted-foreground">
                ÁΩëÁ´ô "{formData.title}" Â∑≤ÊàêÂäüÊ∑ªÂä†Âà∞ÂØºËà™‰∏≠
              </p>
              
              <div className="flex flex-col gap-2">
                <Button 
                  onClick={() => handleSuccessDialogChoice(true)}
                  className="w-full"
                >
                  ÁªßÁª≠Ê∑ªÂä†ÁΩëÁ´ô
                </Button>
                <Button 
                  variant="outline" 
                  onClick={() => handleSuccessDialogChoice(false)}
                  className="w-full"
                >
                  ËøîÂõû‰∏ªÈ°µÈù¢
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      )}

      {/* AIË≠¶ÂëäÂØπËØùÊ°Ü */}
      {showAiWarningDialog && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
          <Card className="w-full max-w-md mx-4">
            <CardHeader className="text-center">
              <div className="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <div className="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center">
                  <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
                  </svg>
                </div>
              </div>
              <CardTitle className="text-yellow-700">Êó†Ê≥ïËé∑ÂèñÁΩëÁ´ôÂÜÖÂÆπ</CardTitle>
            </CardHeader>
            <CardContent className="text-center space-y-4">
              <div className="space-y-2">
                <p className="text-muted-foreground">
                  Êú™ËÉΩÊàêÂäüËé∑ÂèñÁΩëÁ´ôÁöÑËØ¶ÁªÜÂÜÖÂÆπ‰ø°ÊÅØ„ÄÇ
                </p>
                <p className="text-sm text-muted-foreground">
                  ËøôÂèØËÉΩÂØºËá¥ AI ÁîüÊàêÁöÑÂÜÖÂÆπ‰∏çÂ§üÂáÜÁ°ÆÔºåÂõ†‰∏∫ AI Â∞ÜÂü∫‰∫éÊúâÈôêÁöÑ‰ø°ÊÅØÔºà‰ªÖÊ†áÈ¢òÂíåÊèèËø∞ÔºâËøõË°åÂàÜÊûê„ÄÇ
                </p>
              </div>
              
              <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                <p className="text-xs text-yellow-800">
                  <strong>Âª∫ËÆÆÔºö</strong>ËØ∑ÂÖàÁÇπÂáª"Ëá™Âä®Ëé∑Âèñ"ÊåâÈíÆËé∑ÂèñÁΩëÁ´ôËØ¶ÁªÜ‰ø°ÊÅØÔºåÁÑ∂ÂêéÂÜç‰ΩøÁî® AI Â¢ûÂº∫ÂäüËÉΩ‰ª•Ëé∑ÂæóÊõ¥ÂáÜÁ°ÆÁöÑÁªìÊûú„ÄÇ
                </p>
              </div>
              
              <div className="flex flex-col gap-2">
                <Button 
                  variant="outline"
                  onClick={() => handleAiWarningChoice(false)}
                  className="w-full"
                >
                  ÂèñÊ∂àÔºåÂÖàËé∑ÂèñÁΩëÁ´ô‰ø°ÊÅØ
                </Button>
                <Button 
                  onClick={() => handleAiWarningChoice(true)}
                  className="w-full bg-yellow-600 hover:bg-yellow-700"
                >
                  ÁªßÁª≠ AI Â¢ûÂº∫ÔºàÂèØËÉΩ‰∏çÂáÜÁ°ÆÔºâ
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      )}
    </div>
  );
}